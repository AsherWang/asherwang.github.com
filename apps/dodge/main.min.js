var dodge;!function(e){var t=function(t){function i(e){t.call(this),this.isDdbug=!1,this.MAXHP=100,this.HP=100,this.speedX=0,this.speedY=0,this.triggerInvincible=!1,this.readyToReclaim=!1,this.currentImgIndex=0,this.textureList=[],this.textureList=e,this.img=new egret.Bitmap(e[0]),this.addChild(this.img),this.realHeight=this.img.height,this.realWidth=this.img.width}__extends(i,t);var n=(__define,i),s=n.prototype;return s.startAnimate=function(){this.animateTimer||(this.animateTimer=new egret.Timer(100,0)),this.animateTimer.addEventListener(egret.TimerEvent.TIMER,this.onAnimateTimer,this),this.animateTimer.start()},s.stopAnimate=function(){this.animateTimer&&this.animateTimer.stop()},s.onAnimateTimer=function(e){this.currentImgIndex=(this.currentImgIndex+1)%this.textureList.length,this.img.texture=this.textureList[this.currentImgIndex]},s.updatePostion=function(e){this.x+=this.speedX*e,this.y+=this.speedY*e},s.checkHitPoint=function(e){var t=e.x-e.width/2,i=e.y-e.height/2,n=e.x+e.width/2,s=e.y+e.height/2;this.x-this.realWidth/2,this.y-this.realHeight/2;(this.hitPoint(n,i)||this.hitPoint(n,s)||this.hitPoint(t,i)||this.hitPoint(t,s))&&this.effectOnPlayer(e)},s.hitPoint=function(e,t){var i=this.x-this.realWidth/2,n=this.y-this.realHeight/2;return 0>i-e&&i+this.realWidth-e>0&&0>n-t&&n+this.realHeight-t>0},s.effectOnPlayer=function(e){console.log("撞上了")},s.reclaim=function(){e.EntityFactory.reclaim(this,this.name),this.readyToReclaim=!1},s.checkReclaim=function(e,t){return this.readyToReclaim||this.x+this.realWidth<-1e3||this.x>e+1e3||this.y+this.realHeight<-1e3||this.y+this.realHeight>t+1e3},i}(egret.DisplayObjectContainer);e.GameObject=t,egret.registerClass(t,"dodge.GameObject")}(dodge||(dodge={}));var dodge;!function(e){var t=function(e){function t(t){e.call(this,t),this.name="bubble"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.effectOnPlayer=function(e){var t=e.getHurt(30,this);t>0&&console.log("medicine harms our player by "+t+"HP"),this.readyToReclaim=!0},t}(e.GameObject);e.Bubble=t,egret.registerClass(t,"dodge.Bubble")}(dodge||(dodge={}));var dodge;!function(e){var t=function(e){function t(t){e.call(this,t),this.realWidth=70,this.realHeight=100,this.name="deer",this.triggerInvincible=!0}__extends(t,e);var i=(__define,t),n=i.prototype;return n.effectOnPlayer=function(e){var t=e.getHurt(5,this);t>0&&console.log("deer hurt our player by "+t+"HP")},t}(e.GameObject);e.Deer=t,egret.registerClass(t,"dodge.Deer")}(dodge||(dodge={}));var dodge;!function(e){var t=function(){function e(){}var t=(__define,e);t.prototype;return e.produce=function(t,i){null==e.cacheDict[i]&&(e.cacheDict[i]=[]),null==e.textureCacheDict[i]&&(e.textureCacheDict[i]=[]);var n,s=e.cacheDict[i];return n=s.length>0?s.pop():new t(e.textureCacheDict[i])},e.reclaim=function(t,i){null==e.cacheDict[i]&&(e.cacheDict[i]=[]);var n=e.cacheDict[i];-1==n.indexOf(t)&&n.push(t)},e.cacheDict={},e.textureCacheDict={},e}();e.EntityFactory=t,egret.registerClass(t,"dodge.EntityFactory")}(dodge||(dodge={}));var dodge;!function(e){var t=function(e){function t(t){e.call(this,t),this.fire=0,this.skill1cd=30,this.timer=0,this.speedX=3,this.name="hero",this.isDdbug=!0}__extends(t,e);var i=(__define,t),n=i.prototype;return n.setSkill1Textures=function(e){this.skill1TextureList=e},n.onAnimateTimer=function(t){if(e.prototype.onAnimateTimer.call(this,t),0==this.fire&&this.timer++,this.timer==this.skill1cd&&(this.fire=1,this.timer=0),this.currentImgIndex==this.textureList.length-1)if(1==this.fire){var i=this.textureList;this.textureList=this.skill1TextureList,this.skill1TextureList=i,this.fire=2,this.currentImgIndex=-1}else if(2==this.fire){var i=this.textureList;this.textureList=this.skill1TextureList,this.skill1TextureList=i,this.currentImgIndex=this.textureList.length-1,this.fire=0}},t}(e.GameObject);e.Hero=t,egret.registerClass(t,"dodge.Hero")}(dodge||(dodge={}));var dodge;!function(e){var t=function(e){function t(t){e.call(this,t)}__extends(t,e);var i=(__define,t);i.prototype;return t}(e.GameObject);e.Item=t,egret.registerClass(t,"dodge.Item")}(dodge||(dodge={}));var dodge;!function(e){var t=function(e){function t(t){e.call(this,t),this.name="medicine"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.effectOnPlayer=function(e){var t=e.getHealed(20,this);t>0&&console.log("medicine heals our player by "+t+"HP"),this.readyToReclaim=!0},t}(e.GameObject);e.Medicine=t,egret.registerClass(t,"dodge.Medicine")}(dodge||(dodge={}));var dodge;!function(e){var t=function(e){function t(t){e.call(this,t),this.timeHurt=1,this.isInvincible=!1,this.speedX=8,this.speedY=8,this.name="player",this.timer=new egret.Timer(1e3*this.timeHurt)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.getHealed=function(e,t){var i=0;return this.HP+e>this.MAXHP?(i=this.MAXHP-this.HP,this.HP=this.MAXHP):(this.HP+=e,i=e),e},n.getHurt=function(e,t){var i=0;return this.isInvincible||(this.HP-=e,i=e,t.triggerInvincible&&(this.isInvincible=!0,this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.timer.start())),i},n.onTimer=function(e){this.isInvincible=!1},t}(e.GameObject);e.Player=t,egret.registerClass(t,"dodge.Player")}(dodge||(dodge={}));var GameEvent=function(e){function t(t,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),e.call(this,t,i,n)}__extends(t,e);var i=(__define,t);i.prototype;return t.Event={OnGameStart:"OnGameStart",OnGameOver:"OnGameOver",OnGamePause:"OnGamePause",OnGameResume:"OnGameResume",OnGameRestart:"OnGameRestart",OnKeyDown:"OnKeyDown",OnKeyUp:"OnKeyUp"},t}(egret.Event);egret.registerClass(GameEvent,"GameEvent");var dodge;!function(e){var t=function(e){function t(){e.apply(this,arguments),this.isPressed={}}__extends(t,e);var i=(__define,t),n=i.prototype;return n.isLeft=function(){return this.isPressed[65]||this.isPressed[37]||!1},n.isRight=function(){return this.isPressed[68]||this.isPressed[39]||!1},n.isUp=function(){return this.isPressed[87]||this.isPressed[38]||!1},n.isDown=function(){return this.isPressed[83]||this.isPressed[40]||!1},n.onstructor=function(){},n.listen=function(){var e=this,t=[87,38,83,40,65,37,68,39];document.onkeydown=function(i){var n=i||window.event||arguments.callee.caller.arguments[0];n&&t.indexOf(n.keyCode)>=0&&("undefined"==typeof e.isPressed[n.keyCode]||0==e.isPressed[n.keyCode])&&(e.isPressed[n.keyCode]=!0)},document.onkeyup=function(i){var n=i||window.event||arguments.callee.caller.arguments[0];n&&t.indexOf(n.keyCode)>=0&&(e.isPressed[n.keyCode]=!1)}},t}(egret.EventDispatcher);e.KeyboardController=t,egret.registerClass(t,"dodge.KeyboardController")}(dodge||(dodge={}));var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onResourceLoadComplete=function(e){"preload"==e.groupName&&RES.loadGroup("ui"),"ui"==e.groupName?RES.loadGroup("enemy"):"enemy"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},n.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},n.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},n.createGameScene=function(){var e=this.stage.stageWidth,t=this.stage.stageHeight;this.welcomeSceneView=new WelcomeScene,this.welcomeSceneView.height=t/2,this.makeChildCenter(this.welcomeSceneView,e,t),this.stage.addChild(this.welcomeSceneView),this.welcomeSceneView.addEventListener(GameEvent.Event.OnGameStart,this.OnGameStart,this)},n.OnGameStart=function(e){this.welcomeSceneView.removeEventListener(GameEvent.Event.OnGameStart,this.OnGameStart,this),this.stage.removeChild(this.welcomeSceneView),this.gameStart()},n.OnGameRestart=function(e){this.stage.removeChild(this.scoreBoard),this.gameStart()},n.gameStart=function(){this.mainSceneView||(this.mainSceneView=new MainScene),this.stage.addChild(this.mainSceneView),this.mainSceneView.run(),this.mainSceneView.addEventListener(GameEvent.Event.OnGameOver,this.OnGameOver,this),this.mainSceneView.addEventListener(GameEvent.Event.OnGamePause,this.OnGamePause,this),this.mainSceneView.addEventListener(GameEvent.Event.OnGameResume,this.OnGameResume,this)},n.OnGameOver=function(e){this.mainSceneView.removeEventListener(GameEvent.Event.OnGameOver,this.OnGameOver,this),this.mainSceneView.removeEventListener(GameEvent.Event.OnGamePause,this.OnGamePause,this),this.mainSceneView.removeEventListener(GameEvent.Event.OnGameResume,this.OnGameResume,this),this.stage.removeChild(this.mainSceneView);var t=this.stage.stageWidth,i=this.stage.stageHeight;this.scoreBoard||(this.scoreBoard=new ScoreBoard(t,i)),this.makeChildCenter(this.scoreBoard,t,i),this.stage.addChild(this.scoreBoard),this.scoreBoard.addEventListener(GameEvent.Event.OnGameRestart,this.OnGameRestart,this)},n.OnGamePause=function(e){this.mainSceneView.removeEventListener(GameEvent.Event.OnGamePause,this.OnGamePause,this)},n.OnGameResume=function(e){this.mainSceneView.removeEventListener(GameEvent.Event.OnGameResume,this.OnGameResume,this)},n.makeChildCenter=function(e,t,i){e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=t/2,e.y=i/2},t.Size={height:0,weidth:0},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var dodge;!function(e){var t=function(){function e(){}var t=(__define,e),i=t.prototype;return i.save=function(){},i.load=function(){},e}();e.Recorder=t,egret.registerClass(t,"dodge.Recorder")}(dodge||(dodge={}));var dodge;!function(e){var t=function(){function e(){}var t=(__define,e);t.prototype;return e.pad=function(e,t){for(var i=e.toString().length,n=e.toString();t>i;)n="0"+n,i++;return n},e.timeFormat=function(t){var i=Math.floor(t/60),n=t-60*i;return e.pad(i,2)+":"+e.pad(n,2)},e.getRandomValue=function(e,t){return e*Math.floor(Math.random()*(t-1)+1)/t},e.getRandom=function(e,t){return Math.floor(Math.random()*(t-e))+e},e.getRandomElement=function(e){return e[Math.floor(Math.random()*e.length)]},e}();e.Utils=t,egret.registerClass(t,"dodge.Utils")}(dodge||(dodge={}));var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=egret.MainContext.instance.stage.stageWidth,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var MainScene=function(e){function t(){e.call(this),this.time=0,this.enemies=[],this.bkgSpeed=2,this._lastTime=0,this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){this.height=egret.MainContext.instance.stage.stageHeight,this.width=egret.MainContext.instance.stage.stageWidth,this.createBkg();var e=[RES.getRes("hero_run1"),RES.getRes("hero_run2"),RES.getRes("hero_run3"),RES.getRes("hero_run4")];this.hero=new dodge.Hero(e),this.hero.setSkill1Textures([RES.getRes("hero_skill1_1"),RES.getRes("hero_skill1_2"),RES.getRes("hero_skill1_3"),RES.getRes("hero_skill1_4"),RES.getRes("hero_skill1_5"),RES.getRes("hero_skill1_6")]),this.hero.y=this.height-250,this.hero.x=150,this.addChild(this.hero);var t=[RES.getRes("player_flappybird_1"),RES.getRes("player_flappybird_2"),RES.getRes("player_flappybird_3")];this.player=new dodge.Player(t),this.addChild(this.player),this.createUI(),dodge.EntityFactory.textureCacheDict={deer:[RES.getRes("enemy_deer_1"),RES.getRes("enemy_deer_2"),RES.getRes("enemy_deer_3"),RES.getRes("enemy_deer_4"),RES.getRes("enemy_deer_5")],medicine:[RES.getRes("item_medicine_hp")],bubble:[RES.getRes("item_poison_bubble")]},this.timer=new egret.Timer(1e3,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timeToGenerateMonster,this),this.keyboardController=new dodge.KeyboardController,this.keyboardController.listen()},n.timeToGenerateMonster=function(e){this.time++,this.time%3==0&&this.putAnEnemy(),this.updateUI()},n.createBkg=function(){var e=RES.getRes("bkg1");this.textureWidth=e.textureWidth;var t=Math.ceil(this.width/e.textureWidth)+2;this.bkg=[];for(var i=0;t>i;i++){var n=new egret.Bitmap(e);n.y=0,n.x=e.textureWidth*i,this.bkg.push(n),this.addChild(n)}},n.createUI=function(){this.btnPause=new egret.Bitmap(RES.getRes("btn_pause")),this.btnPause.x=10,this.btnPause.y=10,this.btnPause.pixelHitTest=!0,this.timeSign=new egret.TextField,this.timeSign.x=this.width-30,this.timeSign.y=20,this.timeSign.text="00:00",this.timeSign.anchorOffsetX=this.timeSign.width,this.addChild(this.timeSign),this.HPSign=new egret.Shape,this.HPSign.x=20,this.HPSign.y=this.height-50,this.HPSign.alpha=.8,this.addChild(this.HPSign),this.updateUI()},n.Reiniti=function(){for(var e=0;e<this.enemies.length;e++){var t=this.enemies[e];t.reclaim(),this.removeChild(t)}this.enemies=[],this.player.y=this.height/2,this.player.x=this.width/2-this.player.width/2,this.player.HP=this.player.MAXHP;for(var e=0;e<this.bkg.length;e++){var i=this.bkg[e];i.y=0,i.x=i.texture.textureWidth*e}this.time=0,this.updateUI()},n.updateUI=function(){this.timeSign.text=dodge.Utils.timeFormat(this.time),this.HPSign.graphics.clear(),this.HPSign.graphics.lineStyle(1,3355443),this.HPSign.graphics.drawRect(0,0,this.width/2,32),this.HPSign.graphics.beginFill(16742263),this.HPSign.graphics.drawRect(1,1,this.width/2*this.player.HP/this.player.MAXHP,30),this.HPSign.graphics.endFill()},n.onPause=function(e){this.stopAllAnimation(),this.timer.stop()},n.stopAllAnimation=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrame,this),this.enemies.forEach(function(e){e.stopAnimate()}),this.player.stopAnimate(),this.hero.stopAnimate()},n.startAllAnimation=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrame,this),this.enemies.forEach(function(e){e.startAnimate()}),this.player.startAnimate(),this.hero.startAnimate()},n.putAnEnemy=function(){dodge.Utils.getRandomElement([this.putADeer,this.putAHubble,this.putAMedicine]).apply(this)},n.putADeer=function(){var e=dodge.EntityFactory.produce(dodge.Deer,"deer");e.y=dodge.Utils.getRandomValue(this.height,6)-e.realHeight/2,e.x=this.width+300,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.speedX=-4,this.addChildAt(e,this.bkg.length),this.enemies.push(e),e.startAnimate()},n.putAHubble=function(){var e=dodge.EntityFactory.produce(dodge.Bubble,"bubble");e.y=this.height+100,e.x=dodge.Utils.getRandomValue(this.width,6)+e.realWidth,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.speedY=-3,this.addChildAt(e,this.bkg.length),this.enemies.push(e)},n.putAMedicine=function(){var e=dodge.EntityFactory.produce(dodge.Medicine,"medicine");e.y=30,e.x=dodge.Utils.getRandomValue(this.width,6)+e.realWidth,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.speedY=2,this.addChildAt(e,this.bkg.length),this.enemies.push(e)},n.gameOver=function(){this.stopAllAnimation(),this.timer.stop();var e=new GameEvent(GameEvent.Event.OnGameOver);this.dispatchEvent(e)},n.run=function(){this.Reiniti(),this.startAllAnimation(),this.timer.start()},n.enterFrame=function(e){var t=egret.getTimer(),i=1e3/(t-this._lastTime);this._lastTime=t;var n=30/i;this.keyboardController.isUp()&&(this.player.y-=n*this.player.speedY,this.player.y<0&&(this.player.y=0)),this.keyboardController.isDown()&&(this.player.y+=n*this.player.speedY,this.player.y+this.player.height>this.height&&(this.player.y=this.height-this.player.height)),this.keyboardController.isLeft()&&(this.player.x-=n*this.player.speedX,this.player.x<0&&(this.player.x=0)),this.keyboardController.isRight()&&(this.player.x+=n*this.player.speedX,this.player.x+this.player.width>this.width&&(this.player.x=this.width-this.player.width));for(var s=0;s<this.bkg.length;s++){var r=this.bkg[s];r.x-=this.bkgSpeed*n,r.x+this.textureWidth<-this.width&&(r.x+=this.textureWidth*this.bkg.length)}for(var s=0;s<this.enemies.length;s++){var h=this.enemies[s];h.updatePostion(n),h.checkHitPoint(this.player),h.checkReclaim(this.width,this.height)&&(h.reclaim(),this.removeChild(h),this.enemies.splice(s,1),s--)}this.player.HP<=0&&this.gameOver(),this.updateUI()},t}(egret.Sprite);egret.registerClass(MainScene,"MainScene");var ScoreBoard=function(e){function t(t,i){e.call(this),this.width=t,this.width=i,this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){this.btnContinue=new egret.TextField,this.addChild(this.btnContinue),this.btnContinue.y=450,this.btnContinue.textAlign="center",this.btnContinue.verticalAlign="center",this.btnContinue.text="TAP TO CONTINUE",this.btnContinue.width=this.width,this.btnContinue.anchorOffsetX=this.width/2,this.btnContinue.x=this.width/2,this.btnContinue.textColor=16777215,this.blink(this.btnContinue,200),this.board=new egret.TextField,this.board.textFlow=this.getResult(),this.board.textAlign="center",this.board.width=this.width,this.addChild(this.board),this.btnContinue.touchEnabled=!0,this.btnContinue.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onContinue,this)},n.onContinue=function(e){var t=new GameEvent(GameEvent.Event.OnGameRestart);this.dispatchEvent(t)},n.getTextField=function(e){var t=new egret.TextField;return t.text=e,t},n.blink=function(e,t){var i=egret.Tween.get(e,{loop:!0});i.to({alpha:1},t),i.wait(1e3),i.to({alpha:.01},t/2),i.wait(500)},n.getResult=function(){return[{text:"计分板\n\n"},{text:"时间:23s\n"},{text:"得分:44\n"},{text:"回血:33\n"},{text:"受伤次数:233\n"},{text:"排名:1000"},{text:"备注:目前这些都是乱写的"}]},t}(egret.Sprite);egret.registerClass(ScoreBoard,"ScoreBoard");var WelcomeScene=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){this.gameName=new egret.TextField,this.addChild(this.gameName),this.gameName.y=50,this.gameName.width=480,this.gameName.size=80,this.gameName.height=100,this.gameName.textAlign="center",this.gameName.verticalAlign="center",this.gameName.text="dodge",this.gameName.textColor=16777215,this.btnStart=new egret.TextField,this.addChild(this.btnStart),this.btnStart.y=200,this.btnStart.text="PUSH START",this.btnStart.textAlign="center",this.btnStart.verticalAlign="center",this.btnStart.width=480,this.blink(this.btnStart,200),this.btnStart.touchEnabled=!0,this.btnStart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnGameStart,this)},n.blink=function(e,t){var i=egret.Tween.get(e,{loop:!0});i.to({alpha:1},t),i.wait(1e3),i.to({alpha:.01},t/2),i.wait(500)},n.OnGameStart=function(e){var t=new GameEvent(GameEvent.Event.OnGameStart);this.dispatchEvent(t)},t}(egret.Sprite);egret.registerClass(WelcomeScene,"WelcomeScene");