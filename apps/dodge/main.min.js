var dodge;!function(e){var t=function(t){function i(e){t.call(this),this.isDdbug=!1,this.MAXHP=100,this.HP=100,this.basicHarm=0,this.speedX=0,this.speedY=0,this.triggerInvincible=!1,this.isInvincible=!1,this.timeHurt=1,this.readyToReclaim=!1,this.currentImgIndex=0,this.textureList=[],this.textureList=e,this.img=new egret.Bitmap(e[0]),this.addChild(this.img),this.realHeight=this.img.height,this.realWidth=this.img.width,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.timer=new egret.Timer(1e3*this.timeHurt)}__extends(i,t);var n=(__define,i),s=n.prototype;return s.getWidth=function(){return this.img.width},s.getHeight=function(){return this.img.height},s.spin=function(e,t){void 0===e&&(e=1e3),void 0===t&&(t=!0),this.twSpin||(this.twSpin=egret.Tween.get(this,{loop:t}),this.twSpin.to({rotation:360},e))},s.stopSpin=function(){this.twSpin&&egret.Tween.removeTweens(this)},s.startAnimate=function(){this.textureList.length<=1||(this.animateTimer||(this.animateTimer=new egret.Timer(100,0)),this.animateTimer.addEventListener(egret.TimerEvent.TIMER,this.onAnimateTimer,this),this.animateTimer.start())},s.stopAnimate=function(){this.animateTimer&&this.animateTimer.stop()},s.onAnimateTimer=function(e){this.currentImgIndex=(this.currentImgIndex+1)%this.textureList.length,this.img.texture=this.textureList[this.currentImgIndex]},s.updatePostion=function(e){this.x+=this.speedX*e,this.y+=this.speedY*e},s.checkHitPoint=function(e){var t=e.x-e.realWidth/2,i=e.y-e.realHeight/2,n=e.x+e.realWidth/2,s=e.y+e.realHeight/2;return this.hitPoint(n,i)||this.hitPoint(n,s)||this.hitPoint(t,i)||this.hitPoint(t,s)},s.hitPoint=function(e,t){var i=this.x+this.realWidth/2,n=this.y+this.realHeight/2;return e>this.x-this.realWidth/2&&i>e&&t>this.y-this.realHeight/2&&n>t},s.effectOnPlayer=function(e){console.log("撞上了")},s.getHarm=function(){return new e.CommonHarm(this.basicHarm)},s.afterHarm=function(e){},s.afterHuet=function(e){},s.getHurt=function(e,t){var i=0;return(!this.isInvincible||0>e)&&(this.HP-=e,this.correctHP(),i=e,t.triggerInvincible&&e>0&&(this.isInvincible=!0,this.timer||(this.timer=new egret.Timer(1e3*this.timeHurt)),this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.timer.start())),i},s.onTimer=function(e){this.isInvincible=!1,this.timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this)},s.correctHP=function(){this.HP>this.MAXHP&&(this.HP=this.MAXHP),this.HP<0&&(this.HP=0)},s.reclaim=function(){e.EntityFactory.reclaim(this,this.name),this.readyToReclaim=!1},s.checkReclaim=function(e,t){return this.readyToReclaim||this.x+this.realWidth<-1e3||this.x>e+4e3||this.y+this.realHeight<-1e3||this.y+this.realHeight>t+1e3},i}(egret.DisplayObjectContainer);e.GameObject=t,egret.registerClass(t,"dodge.GameObject")}(dodge||(dodge={}));var dodge;!function(e){var t=function(e){function t(t){e.call(this,t),this.name="block",this.basicHarm=1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.afterHarm=function(){this.readyToReclaim=!0},t}(e.GameObject);e.Block=t,egret.registerClass(t,"dodge.Block")}(dodge||(dodge={}));var dodge;!function(e){var t=function(e){function t(t){e.call(this,t),this.name="bubble",this.basicHarm=1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.afterHarm=function(){this.readyToReclaim=!0},t}(e.GameObject);e.Bubble=t,egret.registerClass(t,"dodge.Bubble")}(dodge||(dodge={}));var dodge;!function(e){var t=function(e){function t(t){e.call(this,t),this.name="medicine",this.basicHarm=-1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.afterHarm=function(){this.readyToReclaim=!0},t}(e.GameObject);e.Medicine=t,egret.registerClass(t,"dodge.Medicine")}(dodge||(dodge={}));var dodge;!function(e){var t=function(){function t(){}var i=(__define,t);i.prototype;return t.init=function(){e.EntityFactory.textureCacheDict={medicine:[RES.getRes("item_medicine_hp")],bubble:[RES.getRes("item_poison_bubble")],triangle_red:[RES.getRes("triangle_red")],triangle_blue:[RES.getRes("triangle_blue")],triangle_blond:[RES.getRes("triangle_blond")],triangle_purple:[RES.getRes("triangle_purple")],triangle_greend:[RES.getRes("triangle_green")],rhombus_red:[RES.getRes("rhombus_red")],rhombus_blue:[RES.getRes("rhombus_blue")],rhombus_blond:[RES.getRes("rhombus_blond")],rhombus_green:[RES.getRes("rhombus_green")],rhombus_purple:[RES.getRes("rhombus_purple")]}},t.produce=function(e,i){null==t.cacheDict[i]&&(t.cacheDict[i]=[]),null==t.textureCacheDict[i]&&(t.textureCacheDict[i]=[]);var n,s=t.cacheDict[i];return n=s.length>0?s.pop():new e(t.textureCacheDict[i])},t.reclaim=function(e,i){null==t.cacheDict[i]&&(t.cacheDict[i]=[]);var n=t.cacheDict[i];-1==n.indexOf(e)&&n.push(e)},t.Enemies={gameObject:e.GameObject,medicine:e.Medicine,bubble:e.Bubble,block:e.Block},t.cacheDict={},t.textureCacheDict={},t}();e.EntityFactory=t,egret.registerClass(t,"dodge.EntityFactory")}(dodge||(dodge={}));var dodge;!function(e){var t=function(e){function t(t){e.call(this,t),this.fire=0,this.skill1cd=30,this.skillTimer=0,this.speedX=3,this.name="hero",this.isDdbug=!0}__extends(t,e);var i=(__define,t),n=i.prototype;return n.setSkill1Textures=function(e){this.skill1TextureList=e},n.onAnimateTimer=function(t){if(e.prototype.onAnimateTimer.call(this,t),0==this.fire&&this.skillTimer++,this.skillTimer==this.skill1cd&&(this.fire=1,this.skillTimer=0),this.currentImgIndex==this.textureList.length-1)if(1==this.fire){var i=this.textureList;this.textureList=this.skill1TextureList,this.skill1TextureList=i,this.fire=2,this.currentImgIndex=-1}else if(2==this.fire){var i=this.textureList;this.textureList=this.skill1TextureList,this.skill1TextureList=i,this.currentImgIndex=this.textureList.length-1,this.fire=0}},t}(e.GameObject);e.Hero=t,egret.registerClass(t,"dodge.Hero")}(dodge||(dodge={}));var dodge;!function(e){var t=function(e){function t(t){e.call(this,t)}__extends(t,e);var i=(__define,t);i.prototype;return t}(e.GameObject);e.Item=t,egret.registerClass(t,"dodge.Item")}(dodge||(dodge={}));var dodge;!function(e){var t=function(e){function t(t){e.call(this,t),this.speedX=8,this.speedY=8,this.name="player",this.HP=6,this.MAXHP=6}__extends(t,e);var i=(__define,t),n=i.prototype;return n.getHealed=function(e,t){var i=0;return this.HP+e>this.MAXHP?(i=this.MAXHP-this.HP,this.HP=this.MAXHP):(this.HP+=e,i=e),e},t}(e.GameObject);e.Player=t,egret.registerClass(t,"dodge.Player")}(dodge||(dodge={}));var dodge;!function(e){var t=function(e){function t(t,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),e.call(this,t,i,n)}__extends(t,e);var i=(__define,t);i.prototype;return t.Event={OnGameStart:"OnGameStart",OnGameOver:"OnGameOver",OnGamePause:"OnGamePause",OnGameResume:"OnGameResume",OnGameRestart:"OnGameRestart",OnKeyDown:"OnKeyDown",OnKeyUp:"OnKeyUp"},t}(egret.Event);e.GameEvent=t,egret.registerClass(t,"dodge.GameEvent")}(dodge||(dodge={}));var dodge;!function(e){var t;!function(e){e[e.Wind=0]="Wind",e[e.Fire=1]="Fire",e[e.Water=2]="Water",e[e.Earth=3]="Earth",e[e.Dark=4]="Dark",e[e.Light=5]="Light",e[e.None=6]="None"}(t||(t={}));var i=function(){function e(e){this.poison=!1,this.type=t.None,this.basicHarm=0,this.realHarm=0,this.basicHarm=e}var i=(__define,e);i.prototype;return e.Type=t,e}();e.Harm=i,egret.registerClass(i,"dodge.Harm")}(dodge||(dodge={}));var dodge;!function(e){var t=function(e){function t(t){e.call(this,t)}__extends(t,e);var i=(__define,t);i.prototype;return t}(e.Harm);e.CommonHarm=t,egret.registerClass(t,"dodge.CommonHarm")}(dodge||(dodge={}));var dodge;!function(e){var t=function(){function t(){}var i=(__define,t);i.prototype;return t.calculate=function(t,i,n,s){switch(n.type){case e.Harm.Type.Wind:break;case e.Harm.Type.Water:break;case e.Harm.Type.Fire:break;case e.Harm.Type.Earth:break;case e.Harm.Type.Light:break;case e.Harm.Type.Dark:break;case e.Harm.Type.None:n.realHarm=i.getHurt(n.basicHarm,t),s.hurtTimes++}t.afterHarm(n),i.afterHuet(n)},t}();e.HarmCalculator=t,egret.registerClass(t,"dodge.HarmCalculator")}(dodge||(dodge={}));var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onAddToStage=function(e){this.loadingView=new dodge.LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onResourceLoadComplete=function(e){"preload"==e.groupName?RES.loadGroup("ui"):"ui"==e.groupName?RES.loadGroup("enemy"):"enemy"==e.groupName?RES.loadGroup("block"):"block"==e.groupName?RES.loadGroup("map"):"map"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},n.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},n.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},n.createGameScene=function(){var e=this.stage.stageWidth,t=this.stage.stageHeight;this.welcomeSceneView=new dodge.WelcomeScene,this.welcomeSceneView.height=t/2,this.makeChildCenter(this.welcomeSceneView,e,t),this.stage.addChild(this.welcomeSceneView),this.welcomeSceneView.addEventListener(dodge.GameEvent.Event.OnGameStart,this.OnGameStart,this)},n.OnGameStart=function(e){this.welcomeSceneView.removeEventListener(dodge.GameEvent.Event.OnGameStart,this.OnGameStart,this),this.stage.removeChild(this.welcomeSceneView),this.gameStart()},n.OnGameRestart=function(e){this.stage.removeChild(this.scoreBoard),this.gameStart()},n.gameStart=function(){this.mainSceneView||(this.mainSceneView=new dodge.MainScene),this.stage.addChild(this.mainSceneView),this.mainSceneView.run(),this.mainSceneView.addEventListener(dodge.GameEvent.Event.OnGameOver,this.OnGameOver,this),this.mainSceneView.addEventListener(dodge.GameEvent.Event.OnGamePause,this.OnGamePause,this),this.mainSceneView.addEventListener(dodge.GameEvent.Event.OnGameResume,this.OnGameResume,this)},n.OnGameOver=function(e){this.mainSceneView.removeEventListener(dodge.GameEvent.Event.OnGameOver,this.OnGameOver,this),this.mainSceneView.removeEventListener(dodge.GameEvent.Event.OnGamePause,this.OnGamePause,this),this.mainSceneView.removeEventListener(dodge.GameEvent.Event.OnGameResume,this.OnGameResume,this),this.stage.removeChild(this.mainSceneView);this.stage.stageWidth,this.stage.stageHeight;this.scoreBoard||(this.scoreBoard=new dodge.ScoreBoard),this.scoreBoard.setData(e.msg),this.stage.addChild(this.scoreBoard),this.scoreBoard.addEventListener(dodge.GameEvent.Event.OnGameRestart,this.OnGameRestart,this)},n.OnGamePause=function(e){this.mainSceneView.removeEventListener(dodge.GameEvent.Event.OnGamePause,this.OnGamePause,this)},n.OnGameResume=function(e){this.mainSceneView.removeEventListener(dodge.GameEvent.Event.OnGameResume,this.OnGameResume,this)},n.makeChildCenter=function(e,t,i){e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=t/2,e.y=i/2},t.Size={height:0,weidth:0},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var dodge;!function(e){var t=function(e){function t(){e.apply(this,arguments),this.isPressed={}}__extends(t,e);var i=(__define,t),n=i.prototype;return n.isLeft=function(){return this.isPressed[65]||this.isPressed[37]||!1},n.isRight=function(){return this.isPressed[68]||this.isPressed[39]||!1},n.isUp=function(){return this.isPressed[87]||this.isPressed[38]||!1},n.isDown=function(){return this.isPressed[83]||this.isPressed[40]||!1},n.onstructor=function(){},n.listen=function(){var e=this,t=[87,,83,65,68];document.onkeydown=function(i){var n=i||window.event||arguments.callee.caller.arguments[0];n&&t.indexOf(n.keyCode)>=0&&("undefined"==typeof e.isPressed[n.keyCode]||0==e.isPressed[n.keyCode])&&(e.isPressed[n.keyCode]=!0)},document.onkeyup=function(i){var n=i||window.event||arguments.callee.caller.arguments[0];n&&t.indexOf(n.keyCode)>=0&&(e.isPressed[n.keyCode]=!1)}},t}(egret.EventDispatcher);e.KeyboardController=t,egret.registerClass(t,"dodge.KeyboardController")}(dodge||(dodge={}));var dodge;!function(e){var t=function(){function t(){this.end=!1,this.blockDictionary=RES.getRes("blockDictionary"),this.mazeGenerator=new e.MazeGenerator,this.init(),this.setMap("level1")}var i=(__define,t),n=i.prototype;return n.getBlockDescByindex=function(e){return e>=this.blockDictionary.blocks.length?{name:"gameObject",resName:"rhombus_red"}:this.blockDictionary.blocks[e]},n.isEnd=function(){return this.end},n.setMap=function(e){this.map=RES.getRes(e),this.orbits=this.map.orbits,this.end=0==this.orbits.length},n.init=function(){this.endDistance=egret.MainContext.instance.stage.stageWidth,this.endDistance=0,this.currentOrbitIndex=0,this.startDistance=0,this.backDoor=[0,0,0,0,0,0,0,0,0,0]},n.query=function(e){if(e<this.endDistance)return-1;if(this.currentOrbitIndex>=this.orbits.length)return this.getRandomOrbit(e);this.startDistance=e;var t=this.orbits[this.currentOrbitIndex],i=RES.getRes(t);return this.currentOrbitIndex++,this.end=this.currentOrbitIndex>=this.orbits.length,i},n.setEndDistance=function(e){this.endDistance=e},n.getRandomOrbit=function(t){if(t<this.endDistance)return-1;var i=e.Utils.getRandomElement(["trap1_head","trap1_tail1","trap1_tail2"]);return RES.getRes(i)},n.getRandomOrbitFromGenerator=function(e){if(e<this.endDistance)return-1;for(var t=this.mazeGenerator.generate(this.backDoor),i={enemies:[]},n=0;n<t.length;++n)for(var s=0;10>s;++s)1==t[n][s]&&i.enemies.push([Math.floor(Math.random()*this.blockDictionary.blocks.length),n,s]);return i},n.setBackDoor=function(e){this.backDoor=e},t}();e.MapReader=t,egret.registerClass(t,"dodge.MapReader")}(dodge||(dodge={}));var dodge;!function(e){var t=function(){function e(){this.maze=[]}var t=(__define,e),i=t.prototype;return i.generate=function(e){this.maze=[],this.tunnels=this.getTunnels(e),this.tunnelLength=this.tunnels.length;for(var t=1,i=40;;){var n=[1,1,1,1,1,1,1,1,1,1];if(this.randomForEach(this.tunnels,n,this.extendMaze),this.maze.push(n),this.tunnels=this.getTunnels(n),++t,this.tunnels.length!=this.tunnelLength||t==i)break}return this.maze},i.getTunnels=function(e){for(var t,i=[],n=1,s=0;s<e.length;++s)1==n&&0==e[s]?t=s:0==n&&1==e[s]?i.push([t,s-1]):0==e[s]&&s==e.length-1&&i.push([t,s]),n=e[s];return i},i.randomForEach=function(e,t,i){e.sort(function(e,t){return Math.random()>.5?-1:1}).forEach(function(e){i(e,t)})},i.extendMaze=function(e,t){var i=[0,1,2];e[1]-e[0]>4&&i.push(3);var n,s,r=-1;switch(Math.floor(Math.random()*i.length)){case 0:n=e[0],s=e[1];break;case 1:n=e[0]-1,s=e[1]-1;break;case 2:n=e[0]+1,s=e[1]+1;break;case 3:n=e[0],s=e[1],r=Math.floor((n+s)/2)}0>n&&(n=0);for(var a=n;s>=a;++a)t[a]=0;r>-1&&(t[r]=1)},e}();e.MazeGenerator=t,egret.registerClass(t,"dodge.MazeGenerator")}(dodge||(dodge={}));var dodge;!function(e){var t=function(){function e(){this.time=0,this.distance=0,this.hurtTimes=0,this.totalTime=0,this.totalHurtTimes=0,this.totalDistance=0,this.load()}var t=(__define,e),i=t.prototype;return i.init=function(){this.time=0,this.distance=0,this.hurtTimes=0,this.speed=2.5,this.speedLevel=1},i.getSpeed=function(){return this.speed},i.getSpeedRate=function(){return[0,1,1.1,1.3,1.7,2.2,2.7,3][this.speedLevel]},i.upgradeSpeed=function(){this.speedLevel>6||this.distance>2e3*this.speedLevel&&this.speedLevel++},i.save=function(){window.localStorage.setItem(e.saveName,JSON.stringify({totalDistance:this.totalDistance,totalHurtTimes:this.totalHurtTimes,totalTime:this.totalTime}))},i.load=function(){var t=window.localStorage.getItem(e.saveName);t&&(t=JSON.parse(t),"object"==typeof t&&(this.totalDistance=t.totalDistance,this.totalHurtTimes=t.totalHurtTimes,this.totalTime=t.totalTime))},i.addToTotal=function(){this.totalDistance+=this.distance,this.totalHurtTimes+=this.hurtTimes,this.totalTime+=this.time,this.save()},e.saveName="dodgeSaveData",e}();e.Recorder=t,egret.registerClass(t,"dodge.Recorder")}(dodge||(dodge={}));var dodge;!function(e){var t=function(){function e(){}var t=(__define,e);t.prototype;return e.pad=function(e,t){for(var i=e.toString().length,n=e.toString();t>i;)n="0"+n,i++;return n},e.timeFormat=function(t){var i=Math.floor(t/60),n=t-60*i;return e.pad(i,2)+":"+e.pad(n,2)},e.getRandomValue=function(e,t){return e*Math.floor(Math.random()*(t-1)+1)/t},e.getRandom=function(e,t){return Math.floor(Math.random()*(t-e))+e},e.getRandomElement=function(e){return e[Math.floor(Math.random()*e.length)]},e.pxToMeter=function(e,t){return void 0===t&&(t=2),(e/10).toFixed(t)},e.distance2Screen=function(e,t){return e-t},e.screen2Distance=function(e,t){return e+t},e}();e.Utils=t,egret.registerClass(t,"dodge.Utils")}(dodge||(dodge={}));var dodge;!function(e){var t=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=egret.MainContext.instance.stage.stageWidth,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);e.LoadingUI=t,egret.registerClass(t,"dodge.LoadingUI")}(dodge||(dodge={}));var dodge;!function(e){var t=function(t){function i(i){t.call(this),this.milestoneInterval=1e3,this.recorder=i,this.height=egret.MainContext.instance.stage.stageHeight,this.width=egret.MainContext.instance.stage.stageWidth,this.top=(this.height-e.MainScene.battleHeighgt)/2,this.bottom=this.top+e.MainScene.battleHeighgt,this.texture=RES.getRes("border"),this.bkgWidth=3*this.texture.textureWidth,this.bkgCount=Math.ceil(this.width/this.bkgWidth)+2,this.bkgTop=[],this.bkgBottom=[],this.initBkg(this.bkgTop,!0),this.initBkg(this.bkgBottom,!1),this.milestones=[],this.milestonesCount=Math.ceil(this.width/this.milestoneInterval)+2;for(var n=0;n<this.milestonesCount;++n){var s=new egret.TextField;s.text="↓"+e.Utils.pxToMeter(this.milestoneInterval*n,0)+"m",s.textAlign=egret.HorizontalAlign.LEFT,s.x=this.milestoneInterval*n,s.anchorOffsetY=s.height,s.y=this.top,this.addChild(s),this.milestones.push(s),s.size=20}this.milesOffset=this.milestoneInterval*this.milestonesCount/10}__extends(i,t);var n=(__define,i),s=n.prototype;return s.initBkg=function(e,t){for(var i=0;i<this.bkgCount;i++){var n=new egret.Bitmap(this.texture);n.width=this.bkgWidth,n.y=t?0:this.bottom,n.x=this.bkgWidth*i,n.height=this.top,n.fillMode=egret.BitmapFillMode.REPEAT,e.push(n),this.addChild(n)}},s.updateBkg=function(e,t){for(var i=0;i<e.length;i++){var n=e[i];n.x-=this.recorder.getSpeed()*t,n.x+this.bkgWidth<-10&&(n.x+=this.bkgWidth*this.bkgTop.length)}},s.init=function(){for(var t=0;t<this.milestonesCount;++t){var i=this.milestones[t];i.text="↓"+e.Utils.pxToMeter(this.milestoneInterval*t,0)+"m",i.x=this.milestoneInterval*t}},s.update=function(e){this.updateBkg(this.bkgTop,e),this.updateBkg(this.bkgBottom,e);for(var t=0;t<this.milestonesCount;++t){var i=this.milestones[t];if(i.x-=this.recorder.getSpeed()*e,i.x+i.width<-10){var n=Number(i.text.slice(1,-1))+this.milesOffset;i.x=i.x+this.milestoneInterval*this.milestonesCount,i.text="|"+n+"m"}}},i}(egret.Sprite);e.MainBackground=t,egret.registerClass(t,"dodge.MainBackground")}(dodge||(dodge={}));var dodge;!function(e){var t=function(t){function i(){t.call(this),this.enemies=[],this._lastTime=0,this.createView()}__extends(i,t);var n=(__define,i),s=n.prototype;return s.createView=function(){this.height=egret.MainContext.instance.stage.stageHeight,this.width=egret.MainContext.instance.stage.stageWidth,this.top=(this.height-i.battleHeighgt)/2,this.bottom=this.top+i.battleHeighgt,this.recorder=new e.Recorder,this.bkg=new e.MainBackground(this.recorder),this.addChild(this.bkg);var t=[RES.getRes("player_flappybird_1"),RES.getRes("player_flappybird_2"),RES.getRes("player_flappybird_3")];this.player=new e.Player(t),this.addChild(this.player),this.map=new e.MapReader,e.EntityFactory.init(),this.mainUI=new e.MainUI(this.recorder),this.addChild(this.mainUI),this.keyboardController=new e.KeyboardController,this.keyboardController.listen()},s.Reiniti=function(){for(var e=0;e<this.enemies.length;e++){var t=this.enemies[e];t.reclaim(),this.removeChild(t)}this.enemies=[],this.player.y=this.height/2,this.player.x=this.width/2-this.player.width/2,this.player.HP=this.player.MAXHP,this.map.init(),this.map.setMap("level1"),this.recorder.init(),this.mainUI.init(),this.bkg.init(),this.startAllAnimation()},s.onPause=function(e){this.stopAllAnimation()},s.stopAllAnimation=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrame,this),this.enemies.forEach(function(e){e.stopAnimate()}),this.player.stopAnimate()},s.startAllAnimation=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrame,this),this.enemies.forEach(function(e){e.startAnimate()}),this.player.startAnimate()},s.gameOver=function(){this.stopAllAnimation();var t=new e.GameEvent(e.GameEvent.Event.OnGameOver);t.msg=this.recorder,this.dispatchEvent(t)},s.run=function(){this.Reiniti()},s.enterFrame=function(t){var i=egret.getTimer(),n=1e3/(i-this._lastTime);this._lastTime=i;var s=30/n;s=1;var r=this.recorder.getSpeedRate()*s;this.recorder.distance+=this.recorder.getSpeed()*r,this.mainUI.setDistance(this.recorder.distance),this.keyboardController.isUp()&&(this.player.y-=s*this.player.speedY,this.player.y<this.top+this.player.height/2&&(this.player.y=this.top+this.player.height/2)),this.keyboardController.isDown()&&(this.player.y+=s*this.player.speedY,this.player.y+this.player.height/2>this.bottom&&(this.player.y=this.bottom-this.player.height/2)),this.keyboardController.isLeft()&&(this.player.x-=s*this.player.speedX,this.player.x<this.player.width/2&&(this.player.x=this.player.width/2)),this.keyboardController.isRight()&&(this.player.x+=s*this.player.speedX,this.player.x>this.width-this.player.width/2&&(this.player.x=this.width-this.player.width/2));for(var a=0;a<this.enemies.length;a++){var h=this.enemies[a];h.updatePostion(r),h.checkHitPoint(this.player)&&e.HarmCalculator.calculate(h,this.player,h.getHarm(),this.recorder),h.checkReclaim(this.width,this.height)&&(h.reclaim(),this.removeChild(h),this.enemies.splice(a,1),a--)}this.player.HP<=0&&this.gameOver(),this.bkg.update(r),this.mainUI.setHP(this.player.HP),this.putMonsters(),this.recorder.upgradeSpeed()},s.parseOrbit=function(t){for(var n,s=0,r=[0,0,0,0,0,0,0,0,0,0],a=-1,h=0;h<t.enemies.length;++h){var o=t.enemies[h][1],d=t.enemies[h][2],c=this.map.getBlockDescByindex(t.enemies[h][0]),g=e.EntityFactory.produce(e.EntityFactory.Enemies[c.name],c.resName),l=o*i.rectSize;g.x=l+this.width+g.width/2,g.y=d*i.rectSize+this.top+g.height/2,g.speedX=-this.recorder.getSpeed(),this.addChildAt(g,1),this.enemies.push(g),n=this.recorder.distance+l+i.rectSize,n>s&&(s=n),a==o?r[d]=1:o>a&&(r=[0,0,0,0,0,0,0,0,0,0],r[d]=1)}this.map.setEndDistance(s),this.map.setBackDoor(r)},s.putMonsters=function(){if(this.map.isEnd()){var e=this.map.getRandomOrbitFromGenerator(this.recorder.distance);e.enemies&&this.parseOrbit(e)}else{var e=this.map.query(this.recorder.distance);e&&e.enemies&&this.parseOrbit(e)}},i.battleHeighgt=500,i.rectSize=50,i}(egret.Sprite);e.MainScene=t,egret.registerClass(t,"dodge.MainScene")}(dodge||(dodge={}));var dodge;!function(e){var t=function(t){function i(i){t.call(this),this.MAX_HP=10,this.height=egret.MainContext.instance.stage.stageHeight,this.width=egret.MainContext.instance.stage.stageWidth,this.top=(this.height-e.MainScene.battleHeighgt)/2,this.bottom=this.top+e.MainScene.battleHeighgt,this.distance=new egret.TextField,this.distance.text="0.00",this.distance.x=5,this.distance.y=5,this.addChild(this.distance),this.timeSign=new egret.TextField,this.timeSign.text="00:00",this.timeSign.x=this.width-5,this.timeSign.y=5,this.timeSign.anchorOffsetX=this.timeSign.width,this.addChild(this.timeSign),this.heartTexture=RES.getRes("heart"),this.hearts=[];for(var n=0;n<this.MAX_HP;n++){var s=new egret.Bitmap(this.heartTexture);this.addChild(s),s.width=30,s.height=30,s.anchorOffsetY=s.height,s.x=n*s.width*1.1+5,s.y=this.height-5,s.visible=!1,this.hearts.push(s)}this.btnPause=new egret.Bitmap(RES.getRes("btn_pause")),this.btnPause.x=10,this.btnPause.y=10,this.btnPause.pixelHitTest=!0,this.timer=new egret.Timer(1e3,0),this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.recorder=i}__extends(i,t);var n=(__define,i),s=n.prototype;return s.init=function(){this.timeSeconds=0,this.distance.text="0.00",this.timeSign.text="00:00",this.resume()},s.resume=function(){this.timer.start()},s.stop=function(){this.timer.stop()},s.setHP=function(e){for(var t=0;t<this.MAX_HP;t++)this.hearts[t].visible=e>t},s.setDistance=function(t){this.distance.text=e.Utils.pxToMeter(t)+"m"},s.onTimer=function(t){this.timeSeconds++,this.timeSign.text=e.Utils.timeFormat(this.timeSeconds),this.recorder.time=this.timeSeconds},i}(egret.Sprite);e.MainUI=t,egret.registerClass(t,"dodge.MainUI")}(dodge||(dodge={}));var dodge;!function(e){var t=function(t){function i(){t.call(this),this.height=egret.MainContext.instance.stage.stageHeight,this.width=egret.MainContext.instance.stage.stageWidth,this.createView()}__extends(i,t);var n=(__define,i),s=n.prototype;return s.setData=function(e){this.recorder=e,this.board.textFlow=this.getResult();var t=this.board.height+this.btnContinue.height;this.board.y=(this.height-t)/2-25,this.btnContinue.y=this.board.y+this.board.height+50},s.createView=function(){this.btnContinue=new egret.TextField,this.addChild(this.btnContinue),this.btnContinue.y=this.height-50,this.btnContinue.textAlign="center",this.btnContinue.verticalAlign="center",this.btnContinue.text="PRESS TO CONTINUE",this.btnContinue.width=this.width,this.btnContinue.anchorOffsetX=this.width/2,this.btnContinue.x=this.width/2,this.btnContinue.textColor=16777215,this.blink(this.btnContinue,200),this.board=new egret.TextField,this.board.y=50,this.board.textAlign="center",this.board.width=this.width,this.addChild(this.board),this.btnContinue.touchEnabled=!0,this.btnContinue.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onContinue,this)},s.onContinue=function(t){var i=new e.GameEvent(e.GameEvent.Event.OnGameRestart);this.dispatchEvent(i)},s.getTextField=function(e){var t=new egret.TextField;return t.text=e,t},s.blink=function(e,t){var i=egret.Tween.get(e,{loop:!0});i.to({alpha:1},t),i.wait(1e3),i.to({alpha:.01},t/2),i.wait(500)},s.getResult=function(){return this.recorder.addToTotal(),[{text:"计分板\n\n"},{text:"时间:"+e.Utils.timeFormat(this.recorder.time)+"\n"},{text:"里程:"+e.Utils.pxToMeter(this.recorder.distance)+"m\n"},{text:"受伤次数:"+this.recorder.hurtTimes+"\n\n"},{text:"总时间:"+e.Utils.timeFormat(this.recorder.totalTime)+"\n"},{text:"总里程:"+e.Utils.pxToMeter(this.recorder.totalDistance)+"m\n"},{text:"总受伤次数:"+this.recorder.totalHurtTimes+"\n\n"}]},i}(egret.Sprite);e.ScoreBoard=t,egret.registerClass(t,"dodge.ScoreBoard")}(dodge||(dodge={}));var dodge;!function(e){var t=function(t){function i(){t.call(this),this.createView()}__extends(i,t);var n=(__define,i),s=n.prototype;return s.createView=function(){this.gameName=new egret.TextField,this.addChild(this.gameName),this.gameName.y=50,this.gameName.width=480,this.gameName.size=80,this.gameName.height=100,this.gameName.textAlign="center",this.gameName.verticalAlign="center",this.gameName.text="dodge",this.gameName.textColor=16777215,this.btnStart=new egret.TextField,this.addChild(this.btnStart),this.btnStart.y=200,this.btnStart.text="PRESS START",this.btnStart.textAlign="center",this.btnStart.verticalAlign="center",this.btnStart.width=480,this.blink(this.btnStart,200),this.btnStart.touchEnabled=!0,this.btnStart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnGameStart,this)},s.blink=function(e,t){var i=egret.Tween.get(e,{loop:!0});i.to({alpha:1},t),i.wait(1e3),i.to({alpha:.01},t/2),i.wait(500)},s.OnGameStart=function(t){var i=new e.GameEvent(e.GameEvent.Event.OnGameStart);this.dispatchEvent(i)},i}(egret.Sprite);e.WelcomeScene=t,egret.registerClass(t,"dodge.WelcomeScene")}(dodge||(dodge={}));